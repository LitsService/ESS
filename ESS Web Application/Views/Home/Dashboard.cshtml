
@{
    ViewBag.Title = "Dashboard";
   
}
<style>
    .pointer {
        cursor: pointer;
    }
</style>

@if (Session["UserRole"].ToString().Contains("User") || Session["UserRole"].ToString().Contains("Employees") || Session["UserRole"].ToString().Contains("HR Manager"))
{
    <div class="block-header">
        <div class="row">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <h2>@*<a href="javascript:void(0);" class="btn btn-xs btn-link btn-toggle-fullwidth"><i class="fa fa-arrow-left"></i></a>*@ Dashboard</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="Dashboard"><i class="icon-home"></i></a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                </ul>
            </div>
            <div class="col-lg-6 col-md-4 col-sm-12 text-right">
                @*<div class="bh_chart hidden-xs">
                        <div class="float-left m-r-15">
                            <small>Visitors</small>
                            <h6 class="mb-0 mt-1"><i class="icon-user"></i> 1,784</h6>
                        </div>
                        <span class="bh_visitors float-right">2,5,1,8,3,6,7,5</span>
                    </div>
                    <div class="bh_chart hidden-sm">
                        <div class="float-left m-r-15">
                            <small>Visits</small>
                            <h6 class="mb-0 mt-1"><i class="icon-globe"></i> 325</h6>
                        </div>
                        <span class="bh_visits float-right">10,8,9,3,5,8,5</span>
                    </div>*@
                <div class="bh_chart hidden-sm">
                    <div class="float-left m-r-15">
                        <small>Notifications</small>
                        <h6 class="mb-0 mt-1"><i class="icon-bubbles"></i> @ViewBag.NotificationCount</h6>
                    </div>
                    <span class="bh_chats float-right">1,8,5,6,2,4,3,2</span>
                </div>
            </div>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-lg-3 col-md-6">
            @if (Session["UserRole"].ToString().Contains("HR Manager"))
            {
                <div class="card top_counter">
                    <div class="body">
                        <div class="icon"><i class="fa fa-user"></i> </div>
                        <div class="content">
                            <div class="text">New Employee</div>
                            <h5 class="number">@ViewBag.NewEmpCount</h5>
                        </div>
                        <hr>
                        <div class="icon"><i class="fa fa-users"></i> </div>
                        <div class="content">
                            <div class="text">Total Employee</div>
                            <h5 class="number">@ViewBag.AllEmpCount</h5>
                        </div>
                    </div>
                </div>

                <div class="card top_counter">
                    <div class="body">
                        <div class="icon"><i class="fa fa-university"></i> </div>
                        <div class="content">
                            <div class="text">Total Salary</div>
                            <h5 class="number">$2.8M</h5>
                        </div>
                        <hr>
                        <div class="icon"><i class="fa fa-university"></i> </div>
                        <div class="content">
                            <div class="text">Avg. Salary</div>
                            <h5 class="number">$1,250</h5>
                        </div>
                    </div>
                </div>
            }
        </div>
        @if (Session["UserRole"].ToString().Contains("HR Manager"))
        {
            <div class="col-lg-3 col-md-6">
                <div class="card text-center">
                    <div class="body">
                        <h5>Income Analysis</h5>
                        <span>8% High then last month</span>
                        <div class="sparkline-pie m-t-20">6,4,8</div>
                        <div class="stats-report m-b-30">
                            <div class="stat-item">
                                <h5>Design</h5>
                                <b class="col-black">84.60%</b>
                            </div>
                            <div class="stat-item">
                                <h5>Dev</h5>
                                <b class="col-black">15.40%</b>
                            </div>
                            <div class="stat-item">
                                <h5>SEO</h5>
                                <b class="col-black">5.10%</b>
                            </div>
                        </div>
                        <span id="sparkline-compositeline">8,4,0,0,0,0,1,4,4,10,10,10,10,0,0,0,4,6,5,9,10</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-12">
                <div class="card">
                    <div class="header">
                        <h2>Salary Statistics</h2>
                        <ul class="header-dropdown">
                            <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Weekly">W</a></li>
                            <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Monthly">M</a></li>
                            <li><a class="tab_btn active" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Yearly">Y</a></li>
                            <li class="dropdown">
                                <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                                <ul class="dropdown-menu dropdown-menu-right animated bounceIn">
                                    <li><a href="javascript:void(0);">Action</a></li>
                                    <li><a href="javascript:void(0);">Another Action</a></li>
                                    <li><a href="javascript:void(0);">Something else</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="body">
                        <div id="Salary_Statistics" class="chartist"></div>
                    </div>
                </div>
            </div>
        }
    </div>
    if (Session["UserRole"].ToString().Contains("User") || Session["UserRole"].ToString().Contains("Employees") || Session["UserRole"].ToString().Contains("HR Manager"))
    {
        <div class="row clearfix">
            <div class="col-lg-4 col-md-5">
                <div class="card">
                    <div class="header">
                        <h2>Employee Detail Card</h2>
                    </div>
                    <div class="body text-center">
                        <div class="chart easy-pie-chart-1" data-percent="75">
                            <input type="file" id="UploadImg" style="display:none" />
                            <span><img src="~/Content/assets/images/NoImage.jpg" alt="user" title="Upload Image" class="rounded-circle pointer imgFromScript imgupload" /></span>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Employee ID: </label>
                                <text id="EmpID">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Name: </label>
                                <text id="EmpName">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Designation: </label>
                                <text id="EmpDesg">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Department: </label>
                                <text id="EmpDept">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Nationality</label>
                                <text id="EmpNation">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Address: </label>
                                <text id="EmpAdd">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Phone: </label>
                                <text id="EmpPhone">0</text>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label>Email: </label>
                                <text id="EmpEmail">0</text>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            @*<div class="col-lg-8 col-md-12">
                    <div class="card">
                        <div class="header">
                            <h2>Attendance and Leave Balances</h2>
                            <ul class="header-dropdown">
                                <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Weekly">W</a></li>
                                <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Monthly">M</a></li>
                                <li><a class="tab_btn active" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Yearly">Y</a></li>
                                <li class="dropdown">
                                    <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                                    <ul class="dropdown-menu dropdown-menu-right animated bounceIn">
                                        <li><a href="javascript:void(0);">Action</a></li>
                                        <li><a href="javascript:void(0);">Another Action</a></li>
                                        <li><a href="javascript:void(0);">Something else</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div class="body">
                            <div id="total_Salary" class="ct-chart"></div>
                        </div>
                    </div>
                </div>*@
            <div class="col-lg-8 col-md-12">
                <div class="card">
                    <div class="header">
                        <h2>Documents</h2>

                    </div>
                    <div class="body">
                        <div class="table-responsive">
                            <table id="DocData" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Doc.No</th>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                @*<div class="card">
                        <div class="header">
                            <h2>Notifications</h2>
                        </div>
                        <div class="body">
                            <div class="table-responsive">
                                <table id="NotificationData" class="table table-hover m-b-0">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Date</th>
                                            <th>Request Type</th>
                                            <th>Employee ID</th>
                                            <th>Employee Name</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>*@

                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <table id="LeaveRequestCount" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="2">Leave Request</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>Pending for Approval</td>
                                        <td>Near Expiring</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <table id="ReimbursementRequestCount" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="2">Reimbursement Request</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>Pending for Approval</td>
                                        <td>Near Expiring</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <table id="MiscellaneousRequestCount" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="2">Miscellaneous Request</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>Pending for Approval</td>
                                        <td>Near Expiring</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <table id="Late_and_AbsenceRequestCount" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="2">Late & Absence Request</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>Pending for Approval</td>
                                        <td>Near Expiring</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <table id="AllowanceRequestCount" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="2">Allowance Request</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>Pending for Approval</td>
                                        <td>Near Expiring</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <select id="RequestType" onchange="ChangeRequestType(this)" class="form-control show-tick" style="margin-bottom:2px;">
                                <option value="">Select Request</option>
                                <option value="Leave">Leave Request</option>
                                <option value="Reimbursement">Reimbursement Request</option>
                                <option value="Miscellaneous">Miscellaneous Request</option>
                                <option value="LateandAbsence">Late & Absence Request</option>
                                <option value="Allowance">Allowance Request</option>
                            </select>
                            <table id="App_NotAppRequestCount" class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="2">All Request</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>Approved</td>
                                        <td>Not Approved</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    }
    if (Session["UserRole"].ToString().Contains("HR Manager"))
    {
        <div class="row">
            <div class="col-lg-8 col-md-7">
                <div class="card">
                    <div class="header">
                        <h2>Employee Performance</h2>
                    </div>
                    <div class="body">
                        <div class="table-responsive">
                            <table class="table table-hover m-b-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Avatar</th>
                                        <th>Name</th>
                                        <th>Designation</th>
                                        <th>Performance</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><img src="../assets/images/xs/avatar1.jpg" class="rounded-circle width35" alt=""></td>
                                        <td>Marshall Nichols</td>
                                        <td><span>UI UX Designer</span></td>
                                        <td><span class="badge badge-success">Good</span></td>
                                        <td><span class="sparkbar">5,8,6,3,5,9,2</span></td>
                                    </tr>
                                    <tr>
                                        <td><img src="../assets/images/xs/avatar2.jpg" class="rounded-circle width35" alt=""></td>
                                        <td>Susie Willis</td>
                                        <td><span>Designer</span></td>
                                        <td><span class="badge badge-warning">Average</span></td>
                                        <td><span class="sparkbar">2,1,3,-3,5,9,2</span></td>
                                    </tr>
                                    <tr>
                                        <td><img src="../assets/images/xs/avatar3.jpg" class="rounded-circle width35" alt=""></td>
                                        <td>Francisco Vasquez</td>
                                        <td><span>Team Leader</span></td>
                                        <td><span class="badge badge-primary">Excellent</span></td>
                                        <td><span class="sparkbar">5,8,6,3,5,9,2</span></td>
                                    </tr>
                                    <tr>
                                        <td><img src="../assets/images/xs/avatar4.jpg" class="rounded-circle width35" alt=""></td>
                                        <td>Erin Gonzales</td>
                                        <td><span>Android Developer</span></td>
                                        <td><span class="badge badge-danger">Weak</span></td>
                                        <td><span class="sparkbar">2,-5,3,-6,-4,8,-1</span></td>
                                    </tr>
                                    <tr>
                                        <td><img src="../assets/images/xs/avatar5.jpg" class="rounded-circle width35" alt=""></td>
                                        <td>Ava Alexander</td>
                                        <td><span>UI UX Designer</span></td>
                                        <td><span class="badge badge-success">Good</span></td>
                                        <td><span class="sparkbar">5,8,6,3,5,9,-2</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            @*@if (Session["UserRole"].ToString() == "Admin")
                {*@
            <div class="col-lg-4 col-md-5">
                <div class="card">
                    <div class="header">
                        <h2>Employee Structure</h2>
                    </div>
                    <div class="body text-center">
                        <h6>Male</h6>
                        <input type="text" class="knob2" data-linecap="round" value=@ViewBag.maleCount data-width="125" data-height="125" data-thickness="0.15" data-fgColor="#49a9e5" readonly>
                        <hr>
                        <h6>Female</h6>
                        <input type="text" class="knob2" data-linecap="round" value=@ViewBag.femaleCount data-width="125" data-height="125" data-thickness="0.15" data-fgColor="#b880e1" readonly>
                    </div>
                </div>
            </div>
            @*}*@
        </div>
    }
    if (Session["UserRole"].ToString().Contains("User") || Session["UserRole"].ToString().Contains("Employees") || Session["UserRole"].ToString().Contains("HR Manager"))
    {
        <div class="row">
            @*<div class="col-lg-8 col-md-7">
                    <div class="card">
                        <div class="header">
                            <h2>My Goals</h2>
                        </div>
                        <div class="body">
                            <div class="table-responsive">
                                <table class="table table-hover m-b-0">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Task Name</th>
                                            <th>Plan Date</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Completed</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>HR Training</td>
                                            <td>15 Nov 2020</td>
                                            <td>1 Dec 2020</td>
                                            <td>5 Dec 2020</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>HR Certificate</td>
                                            <td>16 Nov 2020</td>
                                            <td>6 Dec 2020</td>
                                            <td>10 Dec 2020</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>Performance Evaluation for Employees</td>
                                            <td>17 Nov 2020</td>
                                            <td>11 Dec 2020</td>
                                            <td>15 Dec 2020</td>
                                            <td></td>
                                        </tr>
                                        <tr>

                                            <td>Review Calls</td>
                                            <td>18 Nov 2020</td>
                                            <td>16 Dec 2020</td>
                                            <td>20 Dec 2020</td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>*@
        </div>
    }
}
@using (Html.BeginForm("DownloadReport", "Request", FormMethod.Post))
{
    <input type="hidden" id="PrintId" name="DocName" />
    <input type="submit" class="hidden" hidden id="btnSubmit" />
}
<script>
    $(document).ready(function () {
        NotificationDataBinding();
        GetEmployeeDetails();
        GetLeaveRequestCount();
    });

    $(".imgupload").click(function () {
        $('#UploadImg').trigger('click');
    });
    $("#UploadImg").change(function () {
        var data = new FormData();
        var files = $("#UploadImg").get(0).files;
        if (files.length > 0) {
            data.append("MyImages", files[0]);
        }
        $.ajax({
            url: "/Request/UploadFile",
            type: "POST",
            processData: false,
            contentType: false,
            data: data,
            success: function (response) {
                $(".imgFromScript").attr("src", response);
                $("#UploadImg").val('');
            },
            error: function (er) {
            }
        });
    });
    function NotificationDataBinding() {
        $.ajax({
            type: "Post",
            url: "/Home/GetNotificationData",
            success: function (data) {
                $("#NotificationData").DataTable({
                    "lengthChange": true,
                    "pageLength": 25,
                    destroy: true,
                    data: data.Notification,
                    "lengthChange": false,
                    "filter": false,
                    "columns": [
                        { "data": "Date", "autoWidth": true },
                        { "data": "ReqType", "autoWidth": true },
                        { "data": "EmpId", "autoWidth": true },
                        { "data": "EmpName", "autoWidth": true },
                        {
                            render: function (data, type, row) {
                                var html = '';
                                html += ' <button type="button" onclick="ReimbursementEditDataBinding(' + row.Ref + ')" class="btn btn-sm btn-outline-secondary" title="View"><i class="fa fa-pencil"></i></button>';
                                return html;
                            }
                        },
                    ]

                });
                $("#DocData").DataTable({
                    "lengthChange": true,
                    "pageLength": 10,
                    destroy: true,
                    data: data.DocumentList,
                    "lengthChange": false,
                    "filter": false,
                    "columns": [
                        { "data": "DOCID", "autoWidth": true },
                        { "data": "Name", "autoWidth": true },
                        { "data": "DocType", "autoWidth": true },
                        {
                            render: function (data, type, row) {
                                var html = '<button type="button" onclick="DownloadDoc(\'' + row.DOCID + '\')" class="btn btn-sm btn-outline-secondary" title="Download"><i class="fa fa-download"></i></button>';
                                return html;
                            }
                        },
                    ]
                });
                if (data.ProfileImg != null)
                    $(".imgFromScript").attr("src", data.ProfileImg);
            }
        });

    }
    function DownloadDoc(id) {

        if (id == undefined) {
            alert("No Attachement Found");
        }
        else {
            $("#PrintId").val(id);
            $("#btnSubmit").click();
        }
    }
    function GetEmployeeDetails() {
        $.ajax({
            type: "Post",
            url: "/Request/GetEmployeeDetails",
            data: { SelectUserId: @Session["UserID"].ToString() },
            success: function (data) {
                $("#EmpName").text(data.Name);
                $("#EmpDesg").text(data.Designation);
                $("#EmpID").text(data.EmpID);
                $("#EmpNation").text(data.Nationality);
                $("#EmpDept").text(data.Department);
                $("#EmpAdd").text(data.Address);
                $("#EmpPhone").text(data.Phone);
                $("#EmpEmail").text(data.Email);
            }
        });
    }
    function GetLeaveRequestCount()
    {
        $.ajax({
            type: "Post",
            url: "/Home/GetRequestCounts",
            success: function (data) {
                var html = '<tr><td><a href="/Request/LeaveApplicationForm">' + data.LeaveRequest.PendingApproval + '</a></td><td>' + data.LeaveRequest.Expiring + '</td></tr>';
                $("#LeaveRequestCount tbody").append(html);

                var html = '<tr><td><a href="/Request/ReimbursementForm">' + data.Reimbursement.PendingApproval + '</a></td><td>' + data.Reimbursement.Expiring + '</td></tr>';
                $("#ReimbursementRequestCount tbody").append(html);

                var html = '<tr><td><a href="/Request/MiscellaneousApplicationForm">' + data.Miscellaneous.PendingApproval + '</a></td><td>' + data.Miscellaneous.Expiring + '</td></tr>';
                $("#MiscellaneousRequestCount tbody").append(html);

                var html = '<tr><td><a href="/Request/LateandAbsenceJustApplicationForm">' + data.Late_and_Absence.PendingApproval + '</a></td><td>' + data.Late_and_Absence.Expiring + '</td></tr>';
                $("#Late_and_AbsenceRequestCount tbody").append(html);

                var html = '<tr><td><a href="/Request/AllownceRequestForm">' + data.Allowance.PendingApproval + '</a></td><td>' + data.Allowance.Expiring + '</td></tr>';
                $("#AllowanceRequestCount tbody").append(html);
            }
        });

    }

    function ChangeRequestType(e)
    {
        $("#App_NotAppRequestCount tbody").html("");
        $.ajax({
            type: "Post",
            url: "/Home/GetApproved_UnApprovedRequestCounts",
            data: { FormName: $(e).children("option:selected").val()},
            success: function (data) {
                var html = '<tr><td> '+ data.PendingApproval +' </td><td>' + data.Expiring + '</td></tr>';
                $("#App_NotAppRequestCount tbody").append(html);


            }
        });
    }

</script>
